<div class="message-board">
    <h1 class="title">Messages and moments <br /> that lift us up</h1>
    <p class="subtitle">
        Explore heartfelt cards, creative art, and inspiring words from people who care.
        Every message is a reminder that you’re never alone on your journey.
    </p>

    <div class="tabs">
        @for (tab of tabs; track tab) {
            <button
                [class.active]="tab === activeTab()"
                (click)="selectTab(tab)">
                {{ tab }}
            </button>
        }
    </div>

    @if (hasAnyFilter()) {
        <div class="filters-bar">
            <div class="chips">
                @if (filters().title) {
                    <button class="chip" (click)="removeFilter('title')">
                        Title: {{ filters().title }}
                        <span class="x">×</span>
                    </button>
                }
                @if (filters().description) {
                    <button class="chip" (click)="removeFilter('description')">
                        Description: {{ filters().description }}
                        <span class="x">×</span>
                    </button>
                }
                @if (filters().creditTo) {
                    <button class="chip" (click)="removeFilter('creditTo')">
                        Credit: {{ filters().creditTo }}
                        <span class="x">×</span>
                    </button>
                }
                @if (filters().tags?.length) {
                    @for (t of filters().tags; track t) {
                        <button class="chip" (click)="removeTag(t)">
                            #{{ t }}
                            <span class="x">×</span>
                        </button>
                    }
                }
            </div>
            <button class="clear-btn" type="button" (click)="clearAllFilters()">Clear filters</button>
        </div>
    }

    @if (!isLoading()) {
        <div class="card-grid">
            @for (card of filteredCards(); track card; let i = $index) {
                <div
                    class="card"
                    [style]="'--i: ' + ((i - (pageSize * (page() - 1))) * 0.10) + 's'">
                    <div class="card-image-wrap" (click)="openVoicePage(card.id)">
                        <img
                            class="card-image"
                            [src]="card.img"
                            alt="card image" />
                    </div>
                    <div class="card-content">
                        <div class="wrap-category">
                            @if (card.category) {
                                <span
                                    class="category"
                                    (click)="selectTab(card.category)">
                                    {{ card.category }}
                                </span>
                            }
                            @for (tag of card.what; track tag) {
                                <span 
                                    class="category"
                                    (click)="selectTab(tag)">
                                    {{ tag }}
                                </span>
                            }
                            @for (tag of card.express; track tag) {
                                <span 
                                    class="category"
                                    (click)="selectTab(tag)">
                                    {{ tag }}
                                </span>
                            }
                        </div>
                        <h2 class="card-title" (click)="openVoicePage(card.id)">{{ card.location }}</h2>
                    </div>
                </div>
            }
        </div>

        @if (isFetchingMore()) {
            <div class="infinite-loader">
              <div class="loader-wave">
                <div class="wave-dot"></div>
                <div class="wave-dot"></div>
                <div class="wave-dot"></div>
                <div class="wave-dot"></div>
                <div class="wave-dot"></div>
              </div>
            </div>
        }
      
        @if (hasMore()) {
            <div #sentinel class="sentinel" aria-hidden="true"></div>
        }
    } @else {
        <div class="content">
            <div class="loader-wave">
                <div class="wave-dot"></div>
                <div class="wave-dot"></div>
                <div class="wave-dot"></div>
                <div class="wave-dot"></div>
                <div class="wave-dot"></div>
            </div>
        </div>
    }
</div>
