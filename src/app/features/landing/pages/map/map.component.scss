@import 'leaflet/dist/leaflet.css';

:host {
    display: block;
}

::ng-deep #mobileDonateFab {
    opacity: 0;
    pointer-events: none;
    transform: translateY(8px);
}

.map-wrapper {
    display: grid;
    grid-template-rows: auto 1fr;
    gap: 12px;
}

.toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
    padding: 8px 10px;
    // border: 1px solid rgba(0, 0, 0, .08);
    border-radius: 12px;
    // background: var(--card-bg, #fff);
    // box-shadow: 0 2px 12px rgba(0, 0, 0, .04);
}

.filters {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

select {
    padding: 6px 8px;
    border-radius: 10px;
    border: 1px solid rgba(0, 0, 0, .15);
    background: #fff;
}

button.clear {
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid rgba(0, 0, 0, .15);
    background: #fafafa;
}

button.clear:disabled {
    opacity: .5;
}

.meta {
    font-size: 12px;
    opacity: .8;
    display: inline-flex;
    gap: 8px;
}

.loading {
    animation: pulse 1.6s infinite;
}

.map {
    width: 100%;
    height: min(70vh, 800px);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(0, 0, 0, .08);
}

/* Marker dot (matches makeDotIcon) */
.lv-dot-wrap {
    pointer-events: none;
}

::ng-deep .lv-dot {
    width: 14px;
    height: 14px;
    border-radius: 999px;
    background: var(--bg, #3b82f6);
    border: 2px solid var(--bd, #1d4ed8);
    box-shadow: 0 0 0 4px rgba(0, 0, 0, .08);
}

@keyframes pulse {
    0% {
        opacity: .4
    }

    50% {
        opacity: 1
    }

    100% {
        opacity: .4
    }
}

/* Leaflet popup tweak */
.leaflet-popup-content-wrapper {
    border-radius: 10px;
}

::ng-deep {
    .voice-popup {
        .msg {
            margin-top: 6px;
            font-style: italic;
        }

        img {
            max-width: 250px;
            max-height: 250px;
        }
    }

    // .leaflet-popup-content {
    //     width: 100% !important;
    // }

        :root {
            --clu-text: #fff;
            --clu-shadow: 0 8px 22px rgba(0, 0, 0, .18);
            --clu-ring: rgba(99, 102, 241, .25); // indigo ring
        }
    
        /* Базовый кружок */
        .marker-cluster {
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, .12));
    
            div {
                display: grid;
                place-items: center;
                border-radius: 999px;
                color: var(--clu-text);
                font-weight: 700;
                line-height: 1;
                border: 2px solid rgba(255, 255, 255, .9);
                box-shadow: var(--clu-shadow);
                backdrop-filter: saturate(1.3);
                transition: transform .15s ease, box-shadow .15s ease;
                user-select: none;
            }
    
            span {
                padding-top: 1px;
                /* оптика */
                font-size: 12px;
                letter-spacing: .2px;
            }
    
            &:hover div,
            &.leaflet-marker-icon:focus div {
                transform: translateZ(0) scale(1.06);
                box-shadow: 0 10px 26px rgba(0, 0, 0, .22);
            }
        }
    
        /* Цвета/размеры по размеру кластера (дефолтные классы плагина) */
        .marker-cluster-small div {
            /* зелёный */
            background: #34d399 no-repeat;
            width: 34px;
            height: 34px;
            animation: clu-pop .18s ease-out both;
        }
    
        .marker-cluster-medium div {
            /* янтарный */
            background: #fbbf24 no-repeat;
            width: 42px;
            height: 42px;
    
            span {
                font-size: 13px;
            }
            animation: clu-pop .18s ease-out both;
        }
    
        .marker-cluster-large div {
            /* малиновый */
            background: #fb7185 no-repeat;
            width: 50px;
            height: 50px;
    
            span {
                font-size: 14px;
            }
                        animation: clu-pop .18s ease-out both;
        }
    
        /* Акцент-кольцо при фокусе/ховере (доступность + вау) */
        // .marker-cluster:hover::after,
        // .marker-cluster.leaflet-marker-icon:focus::after {
        //     content: "";
        //     position: absolute;
        //     inset: -6px;
        //     border-radius: 999px;
        //     box-shadow: 0 0 0 6px var(--clu-ring);
        //     pointer-events: none;
        // }
    
        /* Лапки spiderfy (когда кластер раскрывается) */
        .leaflet-spider-leg {
            stroke: rgba(0, 0, 0, .35);
            stroke-width: 2.5;
        }
    
        .leaflet-spider-leg:not([stroke]) {
            /* на случай, если плагин не задаёт stroke атрибутом */
            stroke: rgba(0, 0, 0, .35) !important;
            stroke-width: 2.5 !important;
        }
    
        /* Тёмная тема (если нужно) */
        @media (prefers-color-scheme: dark) {
            :root {
                --clu-text: #f8fafc;
                --clu-ring: rgba(165, 180, 252, .3);
            }
    
            .marker-cluster div {
                border-color: rgba(0, 0, 0, .35);
                box-shadow: 0 10px 26px rgba(0, 0, 0, .45);
            }
        }
    
        /* Появление */
        @keyframes clu-pop {
            from {
                transform: scale(.8);
                opacity: .0;
            }
    
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .vp-link {
            cursor: pointer;
        }

        .marker-cluster {
            &.marker-cluster-small, &.marker-cluster-large, &.marker-cluster-medium {
                background-color: transparent;
            }
            
            
        }
}
